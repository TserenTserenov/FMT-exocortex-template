# Протокол Work (Работа)

> **Триггер:** После прохождения Open (WP Gate + Ритуал).
> **Источник:** CLAUDE.md § 2 (slim) → этот файл.

---

## Знай свои сервисы

**Перед началом работы** определи, какие описания методов (сервисы) затронуты.

- Каталог сервисов: `knowledge-mcp search("каталог сервисов", source_type="pack")` → DP.MAP.002
- Не знаешь → СТОП → сверься с MAP.002 → предложи на согласование
- Доменный вопрос → сначала `knowledge-mcp search` → потом ответ (CLAUDE.md § 5)

---

## Capture-to-Pack

> На каждом рубеже (подзадача, паттерн, решение, оптимизация): есть ли знание для записи?

| Тип знания | Куда | Когда | Через KE? |
|------------|------|-------|-----------|
| Правило для всех репо (1-3 строки) | `{{WORKSPACE_DIR}}/CLAUDE.md` | Сразу | Нет |
| Правило для одного репо (1-3 строки) | `<repo>/CLAUDE.md` | Сразу | Нет |
| Доменное (архитектура, паттерны) | Соответствующий Pack | Close | Да (KE) |
| Различение, метод, FM, WP | Соответствующий Pack | Close | Да (KE) |
| Крупный урок | `memory/<topic>.md` | Close | Нет |

**Формат:** *«Capture: [что] → [куда]»*

**MCP-верификация:** Перед записью в Pack → `knowledge-mcp search(тема)` + `knowledge-mcp get_document(файл)` → нет дубликата, нет противоречия.

**Отложенные captures:** Если capture нельзя применить сразу (нужен Close), записать в `DS-strategy/inbox/captures.md` с тегом сессии.

---

## Проверки перед действием (Pre-action Gates)

| Момент | Проверка |
|--------|---------|
| Перед началом работы над задачей | Какие сервисы (MAP.002) затронуты? Нет ответа → СТОП |
| Перед ответом на доменный вопрос | `knowledge-mcp search` → проверить по базе, не полагаться на память |
| Перед записью в Pack | `knowledge-mcp search` + `get_document` → нет дубликата |
| Перед `git commit` в репо с CLAUDE.md | Прочитать CLAUDE.md репо → exit protocol |
| Перед предложением архитектурного решения | АрхГейт (CLAUDE.md § 6): таблица ЭМОГССБ, порог ≥8 |
| Перед добавлением инструмента/агента/системы | IntegrationGate: (1) тип, (2) контур L2/L3/L4, (3) роли, (4) продукты, (5) процессы |

---

## Правила работы

1. **Pull-before-Commit (DS-strategy):** `git pull --rebase` → модификация → `commit` → `push`
2. **Без Obsidian (DS-strategy):** Просмотр через VS Code, НЕ Obsidian
3. **Source-of-truth:** Pack — единственный source-of-truth. Downstream потребляет, не создаёт
4. **Fallback chain:** Downstream → Pack → SPF → FPF → ZP. Непонятно → поднимись выше
5. **Эскалация:** Задача перерастает ≤15 мин? → «Это перерастает в РП. Записать?»

---

## Рубежные проверки

На каждом рубеже (завершённая подзадача, паттерн, решение):

1. ✅ Capture-to-Pack — есть ли знание для записи?
2. ✅ Source-of-truth — не нарушается ли?
3. ✅ Статус РП — обновить если изменился
4. ✅ Context file — актуален ли `DS-strategy/inbox/WP-{N}*.md`?
